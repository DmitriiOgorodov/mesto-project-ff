(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"9979cc68-d26f-4a40-86d9-c2c8b91e4bea","Content-Type":"application/json"}},t=e=>e.ok?e.json():Promise.reject(`Что-то пошло не так: ${e.status}`),o=document.querySelector("#card-template").content;function r(r,a,c){const l=o.querySelector(".places__item").cloneNode(!0),s=l.querySelector(".card__delete-button"),i=l.querySelector(".card__like-button"),u=l.querySelector(".card__image"),d=l.querySelector(".card__like-counter");return l.querySelector(".card__image").src=r.link,l.querySelector(".card__image").setAttribute("alt",r.name),l.querySelector(".card__title").textContent=r.name,u.addEventListener("click",a),d.textContent=r.likes.length,r.owner._id===c?s.addEventListener("click",(o=>{!function(o,r){var n;(n=r,fetch(`${e.baseUrl}/cards/${n}`,{method:"DELETE",headers:e.headers}).then(t)).then((()=>{o.target.closest(".places__item").remove()})).catch((e=>console.log(e)))}(o,r._id)})):s.classList.add("card__delete-button_hidden"),i.addEventListener("click",(o=>{var a;r.likes.some((e=>e._id===c))?(a=r._id,fetch(`${e.baseUrl}/cards/likes/${a}`,{method:"DELETE",headers:e.headers}).then(t)).then((e=>{r.likes=e.likes,d.textContent=e.likes.length,n(o)})).catch((e=>{console.log(e)})):(o=>fetch(`${e.baseUrl}/cards/likes/${o}`,{method:"PUT",headers:e.headers}).then(t))(r._id).then((e=>{r.likes=e.likes,d.textContent=e.likes.length,n(o)})).catch((e=>{console.log(e)}))})),function(e,t,o){e.likes.some((e=>e._id===t))?o.classList.add("card__like-button_is-active"):o.classList.remove("card__like-button_is-active")}(r,c,i),l}function n(e){e.target.classList.toggle("card__like-button_is-active")}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&c(e)}}const s=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},i=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(o.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(o.inactiveButtonClass))};function u(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((o=>{s(e,o,t)})),i(o,r,t)}document.querySelector(".header__logo").src="0863e5bc26221680f1e2.svg";const d=document.querySelector(".places__list");let p;const _=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__avatar-button"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),f=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),q=document.querySelector(".popup_type_new-avatar"),g=document.querySelector(".popup__image"),k=document.querySelector(".popup__caption"),C=document.querySelectorAll(".popup");function E(e){g.src=e.target.src,g.alt=e.target.alt,k.textContent=e.target.alt,a(b)}C.forEach((e=>{e.classList.add("popup_is-animated")})),_.addEventListener("click",(()=>{$.value=y.textContent,A.value=v.textContent,u(f,B),a(f)})),m.addEventListener("click",(()=>{u(S,B),a(S),T.value="",w.value=""})),h.addEventListener("click",(()=>{a(q),u(q,B)})),document.querySelectorAll(".popup__close").forEach((e=>{const t=e.closest(".popup");e.addEventListener("click",(()=>c(t)))})),C.forEach((e=>{e.addEventListener("click",(t=>{t.target===t.currentTarget&&c(e)}))}));const L=q.querySelector("input[name=avatar-link]"),x=document.querySelector(".profile__image");q.addEventListener("submit",(o=>{!function(o){o.preventDefault();const r=q.querySelector(".popup__button");var n;r.textContent="Сохранение...",(n=L.value,fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then(t)).then((e=>{x.style.backgroundImage=`url(${e.avatar})`,c(q)})).catch((e=>{console.log(e)})).finally((()=>{r.textContent="Сохранить"}))}(o)}));const $=f.querySelector("input[name=name]"),A=f.querySelector("input[name=description]"),U=document.querySelector(".profile__image");f.addEventListener("submit",(o=>{!function(o){o.preventDefault();const r=f.querySelector(".popup__button");var n,a;r.textContent="Сохранение...",(n=$.value,a=A.value,fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:a})}).then(t)).then((e=>{y.textContent=e.name,v.textContent=e.about,y.textContent=$.value,v.textContent=A.value,c(f)})).catch((e=>{console.log(e)})).finally((()=>{r.textContent="Сохранить"}))}(o)}));const T=S.querySelector("input[name=place-name]"),w=S.querySelector("input[name=link]");S.addEventListener("submit",(o=>{!function(o){o.preventDefault();const n=S.querySelector(".popup__button");n.textContent="Сохранение...";const a={name:T.value,link:w.value};var l,s;(l=a.name,s=a.link,fetch(`${e.baseUrl}/cards`,{method:"POST",headers:e.headers,body:JSON.stringify({name:l,link:s})}).then(t)).then((e=>{d.prepend(r(e,E,p._id)),T.value="",w.value="",c(S)})).catch((e=>{console.log(e)})).finally((()=>{n.textContent="Создать"}))}(o)}));const B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);i(o,r,t),o.forEach((n=>{n.addEventListener("input",(()=>{((e,t,o)=>{t.validity.valid?s(e,t,o):((e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)})(e,t,t.validationMessage,o)})(e,n,t),i(o,r,t)}))}))})(t,e)}))}(B),Promise.all([fetch(`${e.baseUrl}/users/me`,{headers:e.headers}).then(t),fetch(`${e.baseUrl}/cards`,{headers:e.headers}).then(t)]).then((([e,t])=>(p=e,y.textContent=e.name,v.textContent=e.about,U.style.backgroundImage=`url(${e.avatar})`,t.forEach((e=>{d.append(r(e,E,p._id))})),e._id))).catch((e=>{console.log(e)}))})();