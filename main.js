(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"9979cc68-d26f-4a40-86d9-c2c8b91e4bea","Content-Type":"application/json"}},t=e=>e.ok?e.json():Promise.reject(`Что-то пошло не так: ${e.status}`),o=document.querySelector("#card-template").content;function r(r,n,a){const c=o.querySelector(".places__item").cloneNode(!0),l=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),i=c.querySelector(".card__image"),u=c.querySelector(".card__like-counter");return c.querySelector(".card__image").src=r.link,c.querySelector(".card__image").setAttribute("alt",r.name),c.querySelector(".card__title").textContent=r.name,i.addEventListener("click",n),u.textContent=r.likes.length,r.owner._id===a._id?l.addEventListener("click",(o=>{!function(o,r){o.target.closest(".places__item").remove(),(o=>fetch(`${e.baseUrl}/cards/${o}`,{method:"DELETE",headers:e.headers}).then(t))(r).catch((e=>console.log(e)))}(o,r._id)})):l.classList.add("card__delete-button_hidden"),s.addEventListener("click",(o=>{var n;r.likes.some((e=>e._id===a._id))?(n=r._id,fetch(`${e.baseUrl}/cards/likes/${n}`,{method:"DELETE",headers:e.headers}).then(t)).then((e=>{r.likes=e.likes,u.textContent=e.likes.length})):(o=>fetch(`${e.baseUrl}/cards/likes/${o}`,{method:"PUT",headers:e.headers}).then(t))(r._id).then((e=>{r.likes=e.likes,u.textContent=e.likes.length})),function(e){e.target.classList.toggle("card__like-button_is-active")}(o)})),function(e,t,o){e.likes.some((e=>e._id===t._id))?o.classList.add("card__like-button_is-active"):o.classList.remove("card__like-button_is-active")}(r,a,s),c}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&a(e)}}const l=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},s=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(o.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(o.inactiveButtonClass))};function i(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((o=>{l(e,o,t)})),s(o,r,t)}document.querySelector(".header__logo").src="0863e5bc26221680f1e2.svg";const u=document.querySelector(".places__list");let d;const p=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),m=document.querySelector(".profile__avatar-button"),y=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),v=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".popup_type_new-avatar"),q=document.querySelector(".popup__image"),k=document.querySelectorAll(".popup");function g(e){q.src=e.target.src,q.alt=e.target.alt,document.querySelector(".popup__caption").textContent=e.target.alt,n(S)}k.forEach((e=>{e.classList.add("popup_is-animated")})),p.addEventListener("click",(()=>{L.value=y.textContent,x.value=h.textContent,i(v,T),n(v)})),_.addEventListener("click",(()=>{i(f,T),n(f),A.value="",U.value=""})),m.addEventListener("click",(()=>{n(b),i(b,T)})),document.querySelectorAll(".popup__close").forEach((e=>{const t=e.closest(".popup");e.addEventListener("click",(()=>a(t)))})),k.forEach((e=>{e.addEventListener("click",(t=>{t.target===t.currentTarget&&a(e)}))}));const C=b.querySelector("input[name=avatar-link]"),E=document.querySelector(".profile__image");b.addEventListener("submit",(o=>{!function(o){o.preventDefault();const r=b.querySelector(".popup__button");var n;r.textContent="Сохранение...",(n=C.value,fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then(t)).then((e=>{E.style.backgroundImage=`url(${e.avatar})`,a(b)})).catch((e=>{console.log(e)})).finally((()=>{r.textContent="Сохранить"}))}(o)}));const L=v.querySelector("input[name=name]"),x=v.querySelector("input[name=description]"),$=document.querySelector(".profile__image");v.addEventListener("submit",(o=>{!function(o){o.preventDefault();const r=v.querySelector(".popup__button");var n,c;r.textContent="Сохранение...",y.textContent=L.value,h.textContent=x.value,(n=L.value,c=x.value,fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:c})}).then(t)).then((e=>{y.textContent=e.name,h.textContent=e.about,a(v)})).catch((e=>{console.log(e)})).finally((()=>{r.textContent="Сохранить"}))}(o)}));const A=f.querySelector("input[name=place-name]"),U=f.querySelector("input[name=link]");f.addEventListener("submit",(o=>{!function(o){o.preventDefault();const n=f.querySelector(".popup__button");n.textContent="Сохранение...";const c={name:A.value,link:U.value};var l,s;(l=c.name,s=c.link,fetch(`${e.baseUrl}/cards`,{method:"POST",headers:e.headers,body:JSON.stringify({name:l,link:s})}).then(t)).then((e=>{u.prepend(r(e,g,d)),A.value="",U.value="",a(f)})).catch((e=>{console.log(e)})).finally((()=>{n.textContent="Создать"}))}(o)}));const T={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);s(o,r,t),o.forEach((n=>{n.addEventListener("input",(()=>{((e,t,o)=>{t.validity.valid?l(e,t,o):((e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)})(e,t,t.validationMessage,o)})(e,n,t),s(o,r,t)}))}))})(t,e)}))}(T),Promise.all([fetch(`${e.baseUrl}/users/me`,{headers:e.headers}).then(t),fetch(`${e.baseUrl}/cards`,{headers:e.headers}).then(t)]).then((([e,t])=>(d=e,y.textContent=e.name,h.textContent=e.about,$.style.backgroundImage=`url(${e.avatar})`,t.forEach((t=>{u.append(r(t,g,e))})),e._id))).catch((e=>{console.log(e)}))})();